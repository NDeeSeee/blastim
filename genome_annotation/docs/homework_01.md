# Домашнее задание 1 (~90 минут): функциональный профиль штамма + кейс-расследование

**Организм:** *Bacillus subtilis* 168 (модельный штамм)

## Цель

После запуска пайплайна (Prokka → DIAMOND → Pfam) нужно сделать две вещи, которые реально делают в лаборатории:

1. **Быстрый функциональный профиль штамма** — грубая, но полезная картина "что умеет этот организм" по аннотированным генам.
2. **Кейс-расследование** — разбор одной сомнительной или неполной аннотации.

---

## Как сдаём (Git-практика)

1. Сделайте **fork** репозитория преподавателя к себе в GitHub.
2. Клонируйте свой fork, создайте ветку:
   ```bash
   git checkout -b hw1-<github_username>
   ```
3. Запустите назначение персональных генов:
   ```bash
   export GITHUB_USER=<ваш_github_username>
   python scripts/90_homework_assign_genes.py \
     --run_dir outputs/<ваш_run_папка> \
     --out homework/submissions/$GITHUB_USER/genes_$GITHUB_USER.txt
   ```
4. Скопируйте шаблоны в свою папку:
   ```bash
   mkdir -p homework/submissions/$GITHUB_USER
   cp homework/TEMPLATE_summary.md homework/submissions/$GITHUB_USER/summary_$GITHUB_USER.md
   cp homework/TEMPLATE_case.md    homework/submissions/$GITHUB_USER/case_$GITHUB_USER.md
   ```
5. Заполните два файла, затем:
   ```bash
   git add homework/submissions/$GITHUB_USER/
   git commit -m "HW1: $GITHUB_USER"
   git push origin hw1-$GITHUB_USER
   ```
6. Откройте **Pull Request** в основной репозиторий преподавателя.

---

## Индивидуализация

Каждому студенту назначается персональный набор из **12 генов** (детерминированно по GitHub username). Скрипт `90_homework_assign_genes.py` выбирает гены, для которых есть записи и в DIAMOND, и в Pfam, чтобы у каждого был материал для анализа.

**Как использовать assigned genes:**
- **Часть 1 (Профиль)**: Используйте минимум 6 из ваших 12 assigned генов (по 1 на каждый функциональный блок). Можете добавить дополнительные гены, найденные самостоятельно, если хотите.
- **Часть 2 (Кейс)**: Выберите 1 ген (желательно из ваших assigned) для глубокого анализа.

---

## Часть 1 (40-50 минут): Мини-профиль штамма

**Файл для сдачи:** `homework/submissions/<user>/summary_<user>.md`

Заполните 6 функциональных блоков (минимум 1 ген в каждом, можно больше):

1. **Репликация / ремонт ДНК**
2. **Транскрипция / трансляция** (housekeeping: рибосомные белки, РНК-полимеразы, факторы трансляции)
3. **Метаболизм** (выберите один конкретный путь, например: гликолиз, синтез аминокислот, дыхательная цепь)
4. **Транспорт / мембраны** (ABC-транспортёры, каналы, мембранные белки)
5. **Регуляция** (HTH-факторы, two-component системы, киназы, сигма-факторы)
6. **Стресс-ответ / споры** (если встретили: heat shock, spore formation, SOS-response)

### Формат для каждого гена (4 строки обязательно):

- **Prokka product** — как записано в GFF/TSV
- **DIAMOND** — pident (%), evalue, coverage (qcovs = length/qlen × 100%), best hit title
- **Pfam** — 1-2 ключевых домена (название + evalue)
- **Вывод** — 1 фраза: почему evidence поддерживает ИЛИ опровергает аннотацию

> **Coverage** = (alignment length) / (query length) × 100%
>
> Пример: если alignment length = 200, query length = 250, то coverage = 80%

### Общий вывод (обязательно)

После 6 блоков добавьте итоговый раздел (3-5 предложений):
- Что у штамма "явно хорошо видно" по аннотации
- Где больше неопределённости и почему
- Какие 1-2 шага добавили бы уверенности (что бы вы сделали дальше)

---

## Часть 2 (30-40 минут): Кейс-расследование

**Файл для сдачи:** `homework/submissions/<user>/case_<user>.md`

Выберите **1 ген** (желательно из ваших assigned), который выглядит сомнительно. Примеры проблем:

- E-value хороший, но coverage низкий (< 50%) → совпал только домен/мотив, а не весь белок
- Pfam домены не поддерживают слишком конкретный product от Prokka
- Белок сильно короче/длиннее, чем best hit → подозрение на ошибку предсказания границ CDS
- Prokka написал "hypothetical protein", но Pfam даёт понятный функциональный класс
- Top hits в DIAMOND дают разные функции → семейство паралогов с разной специфичностью

### Формат кейса (жёсткий, все пункты обязательны):

1. **Gene ID** + текущая аннотация Prokka
2. **DIAMOND evidence** — вставьте строку из TSV + короткая интерпретация
3. **Pfam evidence** — список доменов + интерпретация (поддерживают ли функцию?)
4. **1-2 гипотезы** почему аннотация сомнительна (выберите из чекбоксов в шаблоне)
5. **Предложение** более честной аннотации (было → предлагаю + обоснование)
6. **Как бы проверили дальше** (1-2 конкретные идеи)

> **Примеры дальнейшей проверки:** ручной BLAST на NCBI nr, сравнить длину с референсом, посмотреть соседние гены (операон/синтения), проверить сборку, поискать в базе KO/COG, найти экспериментальную литературу.

---

## Самопроверка (опционально)

```bash
python scripts/91_homework_check.py --user $GITHUB_USER
```

Скрипт проверит:
- Файлы существуют и не пусты
- Содержат ключевые слова: "Prokka", "DIAMOND", "Pfam", "Вывод" (для summary)
- Содержат ключевые слова: "Gene ID", "evidence", "гипотез" (для case)

Или через Make:

```bash
make homework-check
```

---

## Пример (для ориентира)

### Gene: ANNOT_00042 (из Part 1, блок "Транскрипция")

- **Prokka product:** 50S ribosomal protein L10
- **DIAMOND:** pident=89%, evalue=2e-78, coverage=98%, hit: 50S ribosomal protein L10 [*Bacillus licheniformis*]
- **Pfam:** Ribosomal_L10 (PF00466, e=3e-45)
- **Вывод:** Высокая идентичность, полное покрытие и консервативный домен — уверенная аннотация рибосомного белка.

---

## Критерии оценивания (5 баллов)

| Балл | Критерий |
|------|----------|
| **1** | Гены логично распределены по функциональным блокам (каждый ген явно соответствует категории) |
| **2** | Корректная интерпретация **всех трёх** метрик: identity, e-value, coverage — не только identity! |
| **3** | Pfam-домены действительно поддерживают или опровергают аннотацию (не просто перечислены) |
| **4** | Предложенная правка product аккуратная, честная и хорошо обоснована |
| **5** | Отчёт понятный, компактный, без лишних слов — легко читается и проверяется |

### Типичные ошибки (избегайте):

- ❌ Игнорировать coverage (смотреть только на identity)
- ❌ Перечислять Pfam-домены без интерпретации ("есть домен X" — недостаточно, нужно объяснить, что он значит)
- ❌ Выбирать очевидно правильные гены для кейса (тогда нечего расследовать)
- ❌ Писать длинно и размыто (чётко, по пунктам)

---

## Часто задаваемые вопросы

**Q: Сколько генов всего нужно проанализировать?**

A: Минимум **7 генов**: 6 для Part 1 (по 1 на блок) + 1 для Part 2 (кейс). Можете больше, если хотите.

**Q: Где взять данные для DIAMOND и Pfam?**

A: В вашей папке `outputs/run_*/`:
- DIAMOND: `diamond/blastp_results.tsv` (ищите по Gene ID в первой колонке)
- Pfam: `hmmer/hmmscan_domtblout.txt` (ищите по Gene ID в 4-й колонке после символа `#`)

**Q: Что если мой assigned ген — hypothetical protein и у него нет ни DIAMOND, ни Pfam hits?**

A: Скрипт назначения (`90_homework_assign_genes.py`) специально выбирает гены с hits в обеих базах. Если всё же попался пустой, возьмите другой из списка или найдите похожий самостоятельно.

**Q: Можно ли использовать гены не из assigned списка?**

A: Да, для Part 1 можно брать любые гены. Для Part 2 (кейс) желательно использовать assigned.

**Q: Как посчитать coverage, если в DIAMOND TSV это не отдельная колонка?**

A: DIAMOND не выводит coverage напрямую. Формула: `coverage (%) = (length / qlen) × 100`
- `length` — колонка 4 в TSV (alignment length)
- `qlen` — колонка 13 в TSV (query length — длина вашего белка)

**Q: Что если я потратил больше 90 минут?**

A: Это нормально при первом знакомстве с форматами. Главное — качество анализа, а не скорость.
