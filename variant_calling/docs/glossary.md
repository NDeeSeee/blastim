# Глоссарий: поиск геномных вариантов

Ключевые термины, концепции и инструменты, используемые в практикуме.

---

## Термины

### Биологические

| Термин | Определение |
|--------|------------|
| **SNP** (Single Nucleotide Polymorphism) | Однонуклеотидный полиморфизм — замена одного нуклеотида. Самый частый тип геномных вариантов |
| **InDel** (Insertion/Deletion) | Вставка или делеция одного или нескольких нуклеотидов |
| **MNP** (Multi-Nucleotide Polymorphism) | Замена нескольких соседних нуклеотидов одновременно |
| **Аллель** | Конкретный вариант нуклеотидной последовательности в данной позиции. REF — референсный аллель, ALT — альтернативный |
| **Генотип** | Набор аллелей в данной позиции. Для гаплоида: `0` (REF) или `1` (ALT). Для диплоида: `0/0`, `0/1`, `1/1` |
| **Плоидность** | Число копий генома в клетке. Бактерии — 1 (гаплоид), человек — 2 (диплоид) |
| **Гетерозигота** | Позиция с двумя разными аллелями (только для диплоидов и выше). Генотип `0/1` |
| **Гомозигота** | Позиция с двумя одинаковыми аллелями. Генотип `0/0` (по REF) или `1/1` (по ALT) |
| **Транзиция (Ti)** | Замена пурина на пурин (A↔G) или пиримидина на пиримидин (C↔T). Встречается чаще трансверсий |
| **Трансверсия (Tv)** | Замена пурина на пиримидин или наоборот (A↔C, A↔T, G↔C, G↔T) |
| **Ti/Tv ratio** | Отношение числа транзиций к трансверсиям. Для реальных SNP обычно ~2.0-2.5. Низкий Ti/Tv может указывать на артефакты |

### Биоинформатические

| Термин | Определение |
|--------|------------|
| **Variant calling** | Процесс обнаружения геномных вариантов путём сравнения прочтений с референсным геномом |
| **Покрытие (coverage/depth)** | Среднее число прочтений, перекрывающих каждую позицию генома. 50x = каждая позиция покрыта в среднем 50 прочтениями |
| **QUAL** (Phred-scaled quality) | Оценка качества варианта: QUAL = -10 × log₁₀(P(ошибка)). QUAL=20 → 1% ошибка, QUAL=30 → 0.1% |
| **DP** (Depth) | Глубина покрытия в конкретной позиции. Слишком низкий DP — мало данных, слишком высокий — возможный артефакт (дупликация, повтор) |
| **AO / RO** | Число прочтений, поддерживающих ALT (Alternate Observation) и REF (Reference Observation) |
| **Strand bias** | Смещение прочтений ALT-аллеля на одну цепь ДНК. Сильный strand bias (SAP > 20) — признак артефакта секвенирования |
| **Mapping quality (MAPQ)** | Качество выравнивания прочтения на геном. MAPQ=0 означает, что прочтение выравнивается на несколько позиций одинаково хорошо |
| **Hard filtering** | Фильтрация вариантов по фиксированным порогам (QUAL, DP и т.д.). Простая, но грубая |
| **Soft filtering** | Пометка вариантов тегом в поле FILTER, но без удаления из файла. Позволяет пересмотреть решение позже |
| **Ложноположительный** (false positive) | Вариант, вызванный ошибкой секвенирования или выравнивания, а не реальной мутацией |
| **Ложноотрицательный** (false negative) | Реальный вариант, пропущенный при variant calling (из-за низкого покрытия, плохого выравнивания и т.д.) |

### Форматы данных

| Формат | Описание |
|--------|----------|
| **FASTA** | Текстовый формат для нуклеотидных/белковых последовательностей. Заголовок начинается с `>` |
| **FASTQ** | FASTA + качество каждого нуклеотида (Phred-score). Стандартный формат данных секвенирования |
| **SAM** | Sequence Alignment/Map — текстовый формат выравниваний прочтений на геном |
| **BAM** | Бинарная (сжатая) версия SAM. Требует индекса (.bai) для произвольного доступа |
| **VCF** | Variant Call Format — стандартный формат для описания геномных вариантов. Столбцы: CHROM, POS, ID, REF, ALT, QUAL, FILTER, INFO |
| **bgzip** | Block-gzip — формат сжатия с поддержкой произвольного доступа. Внешне похож на gzip, но позволяет индексирование через tabix |

---

## Концепции

### Почему нужна фильтрация

Variant caller'ы намеренно вызывают больше вариантов, чем есть на самом деле (высокая чувствительность). Задача фильтрации — убрать артефакты, сохранив настоящие варианты. Основные фильтры:
- **QUAL** — уверенность caller'а в варианте. Низкий QUAL → мало статистических доказательств
- **DP** — слишком низкий = мало данных, слишком высокий = возможный артефакт (повтор, дупликация)
- **Strand bias** — если все прочтения ALT с одной цепи, вероятен артефакт секвенирования

### Ti/Tv ratio как контроль качества

Транзиции (A↔G, C↔T) происходят чаще трансверсий по биохимическим причинам. Ожидаемый Ti/Tv:
- Для WGS данных: ~2.0-2.5
- Для экзомных данных: ~2.8-3.2

Если Ti/Tv < 1.5 — в данных много ложноположительных вариантов (артефакты не имеют биологического смещения в сторону транзиций). Это простой и мощный индикатор качества.

### bgzip ≠ gzip

Обычный gzip сжимает файл целиком — для чтения нужно распаковать всё. bgzip сжимает блоками по 64 КБ, что позволяет tabix находить нужный регион без распаковки всего файла. Это критично для больших VCF/BAM: запрос «покажи варианты на chr1:100000-200000» выполняется за миллисекунды, а не минуты.

### Haplotype-based vs pileup-based calling

Два основных подхода к поиску вариантов:
- **Pileup-based** (bcftools mpileup/call) — смотрит на каждую позицию независимо. Быстрый, но может пропускать сложные варианты
- **Haplotype-based** (freebayes, GATK HaplotypeCaller) — рассматривает локальные гаплотипы (комбинации близких вариантов). Точнее для indel'ов и сложных вариантов, но медленнее

В этом практикуме мы используем freebayes (haplotype-based), потому что он даёт богатые INFO-поля (AO, RO, SRP, SAP) для учебного анализа.

### Что означают поля freebayes

freebayes записывает в VCF больше информации, чем минимально требуется:
- **AO/RO** — число прочтений за ALT/REF. Позволяет вычислить наблюдаемую частоту аллеля: AO/(AO+RO)
- **SAF/SAR** — прочтения ALT на forward/reverse цепи. Если SAF=20, SAR=0 — сильный strand bias
- **SRP/SAP** — Phred-scaled вероятность strand bias для REF/ALT. SAP > 20 → P(bias) < 0.01
- **RPP/RPL/RPR** — position bias: распределение ALT-прочтений по позиции вдоль прочтения
- **MQM/MQMR** — среднее качество маппинга для ALT/REF прочтений

---

## Инструменты

### freebayes

| | |
|---|---|
| **Что делает** | Bayesian haplotype-based variant caller. Находит SNP, InDel, MNP и сложные варианты |
| **Вход** | BAM (выравнивание) + FASTA (референс) |
| **Выход** | VCF с богатыми INFO-полями |
| **Почему freebayes** | Богатые INFO-поля (AO, RO, SRP, SAP) идеальны для обучения оценке вариантов. Простая установка, работает «из коробки» |
| **Альтернативы** | **GATK HaplotypeCaller** — индустриальный стандарт для клинических данных, но сложнее в настройке. **bcftools mpileup/call** — быстрый pileup-based подход |
| **Ограничения** | Однопоточный (медленнее на больших геномах). Для больших проектов используют freebayes-parallel |

### bcftools

| | |
|---|---|
| **Что делает** | Универсальный инструментарий для работы с VCF/BCF: фильтрация, статистика, запросы, конвертация |
| **Ключевые команды** | `view` — фильтрация и конвертация. `stats` — статистика (SNP/indel, Ti/Tv). `query` — извлечение данных в произвольном формате. `filter` — soft-filtering (пометка тегом) |
| **Почему bcftools** | Стандарт де-факто для работы с VCF. Быстрый, гибкий, хорошо документированный |
| **Альтернативы** | **GATK** — для сложных пайплайнов. **vcftools** — устаревший, но ещё используется |

### samtools

| | |
|---|---|
| **Что делает** | Работа с SAM/BAM/CRAM: сортировка, индексирование, статистика, pileup |
| **Ключевые команды** | `sort` — сортировка BAM по координатам. `index` — создание .bai индекса. `flagstat` — статистика выравнивания. `depth` — глубина покрытия. `faidx` — индексирование FASTA |
| **Почему samtools** | Стандарт для работы с BAM. Необходим для подготовки данных перед variant calling |

### BWA

| | |
|---|---|
| **Что делает** | Выравнивание коротких прочтений на референсный геном (Burrows-Wheeler Aligner) |
| **Ключевая команда** | `bwa mem` — выравнивание парных прочтений (основной алгоритм для Illumina 70-300bp) |
| **Почему BWA** | Стандарт для коротких прочтений. Быстрый, точный, широко используется в пайплайнах |
| **Альтернативы** | **Bowtie2** — альтернативный выравниватель. **minimap2** — для длинных прочтений (PacBio, Nanopore) |

### Вспомогательные инструменты

| Инструмент | Назначение |
|------------|-----------|
| **bgzip** (htslib) | Block-gzip сжатие VCF с поддержкой произвольного доступа |
| **tabix** (htslib) | Создание индексов для bgzip-сжатых VCF/BED/GFF — позволяет запросы по регионам |
| **wgsim** (samtools) | Симулятор коротких прочтений из референсного генома. Используется для создания тестовых данных с известными мутациями |
| **seqkit** | Быстрая работа с FASTA/FASTQ: статистика, фильтрация, извлечение последовательностей |
